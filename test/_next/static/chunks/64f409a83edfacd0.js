(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75594,e=>{e.v("/qr/test/_next/static/media/qrScanner.worker.56648bf8.ts")},94237,e=>{e.v(e.b(["static/chunks/4abec84cb89c211f.js","static/chunks/turbopack-9c5572aebae2422e.js"]))},99024,e=>{"use strict";var t=e.i(43476),r=e.i(71645);function a(){let a=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),c=(0,r.useRef)(null),s=(0,r.useRef)(null),l=(0,r.useRef)(0),u=(0,r.useRef)(null),o=(0,r.useRef)(null),d=(0,r.useRef)(0),m=(0,r.useRef)(null),h=(0,r.useRef)(null),f=(0,r.useRef)(null),g=(0,r.useRef)(new Map),[p,v]=(0,r.useState)(!1),[x,y]=(0,r.useState)(!1),[j,w]=(0,r.useState)(!1),[b,R]=(0,r.useState)([]),[T,_]=(0,r.useState)(null),[k,C]=(0,r.useState)(null),[N,A]=(0,r.useState)(!1),[S,E]=(0,r.useState)(!1),[F,I]=(0,r.useState)(!1),D=(0,r.useMemo)(()=>{let e=window.Telegram?.WebApp?.platform;if(e&&["ios","android","android_x"].includes(e))return!0;let t=window.navigator?.userAgent??"";return/iphone|ipad|ipod|android/i.test(t)},[]),q=(0,r.useMemo)(()=>j?"Ð—Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÐºÐ°Ð¼ÐµÑ€Ðµâ€¦":p?x?"ÐšÐ¾Ð´ ÑÑ‡Ð¸Ñ‚Ð°Ð½ â€” Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ Ñ‡ÐµÑ€ÐµÐ· ÑÐµÐºÑƒÐ½Ð´Ñƒ":"ÐÐ°Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ°Ð¼ÐµÑ€Ñƒ Ð½Ð° QR-ÐºÐ¾Ð´":!1===k?"ÐšÐ°Ð¼ÐµÑ€Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° â€” Ð²Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹":"ÐšÐ°Ð¼ÐµÑ€Ð° Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°",[p,x,k,j]),M=(0,r.useCallback)(()=>{m.current&&(clearTimeout(m.current),m.current=null),h.current&&(clearTimeout(h.current),h.current=null)},[]),U=(0,r.useCallback)(()=>{M(),null!==o.current&&(cancelAnimationFrame(o.current),o.current=null),null!==u.current&&(u.current=null,a.current?.postMessage({type:"reset"}));let e=s.current;if(e&&(e.getTracks().forEach(e=>e.stop()),s.current=null),n.current){try{n.current.pause()}catch{}n.current.srcObject=null}v(!1),y(!1),A(!1),E(!1),I(!1),w(!1)},[M]);(0,r.useEffect)(()=>{let t=new Worker(e.r(94237));a.current=t;let r=g.current;return t.onmessage=e=>{let t=e.data,r=g.current.get(t.requestId);if(r)if(g.current.delete(t.requestId),u.current=null,"result"===t.type)r.resolve({text:t.text,format:t.format,rawBytes:t.rawBytes});else{let e=Error(t.message);e.name=t.name,t.notFound&&(e.notFound=!0),r.reject(e)}},()=>{t.postMessage({type:"reset"}),t.terminate(),u.current=null,r.forEach(({reject:e})=>{e(Error("Ð’Ð¾Ñ€ÐºÐµÑ€ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"))}),r.clear()}},[]);let O=(0,r.useCallback)((e,t)=>{let r=a.current;if(!r)return Promise.reject(Error("Ð¡ÐºÐ°Ð½ÐµÑ€ ÐµÑ‰Ñ‘ Ð½Ðµ Ð³Ð¾Ñ‚Ð¾Ð²"));let n=++l.current;return u.current=n,new Promise((a,i)=>{g.current.set(n,{resolve:a,reject:i}),r.postMessage({type:"decode",requestId:n,imageData:e,enhance:t?.enhance})})},[]),B=(0,r.useCallback)(async()=>{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;f.current||(f.current=new e);let t=f.current;if(!t)return;if("suspended"===t.state)try{await t.resume()}catch{return}let r=t.createOscillator(),a=t.createGain();r.type="triangle",r.frequency.setValueAtTime(880,t.currentTime),a.gain.setValueAtTime(.001,t.currentTime),a.gain.exponentialRampToValueAtTime(.25,t.currentTime+.02),a.gain.exponentialRampToValueAtTime(.001,t.currentTime+.18),r.connect(a),a.connect(t.destination),r.start(),r.stop(t.currentTime+.18)},[]),P=(0,r.useCallback)((e,t)=>{if(R(r=>{let a=r.filter(r=>r.source!==t||r.text!==e);return[{text:e,timestamp:Date.now(),source:t},...a].slice(0,20)}),_(null),"undefined"!=typeof navigator&&"vibrate"in navigator)try{navigator.vibrate?.(200)}catch{}if(B(),A(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{A(!1),h.current=null},220),"camera"===t){if(y(!0),n.current)try{n.current.pause()}catch{}m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{y(!1),m.current=null,n.current&&n.current.play().catch(()=>void 0)},1500)}},[B]),V=(0,r.useCallback)(e=>{if(!p||x)return;let t=()=>{o.current=requestAnimationFrame(V)};if(null!==u.current)return void t();let r=n.current,a=i.current;if(!r||!a||!r.videoWidth||!r.videoHeight||e-d.current<250)return void t();let c=a.getContext("2d",{willReadFrequently:!0});if(!c)return void t();(a.width!==r.videoWidth||a.height!==r.videoHeight)&&(a.width=r.videoWidth,a.height=r.videoHeight),c.drawImage(r,0,0,a.width,a.height);let s=c.getImageData(0,0,a.width,a.height);d.current=e,O(s).then(e=>{P(e.text,"camera")}).catch(e=>{e?.notFound||e?.name==="NotFoundException"||_(e?.message??"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ")}),t()},[p,x,O,P]);(0,r.useEffect)(()=>{if(p&&!x)return o.current=requestAnimationFrame(V),()=>{null!==o.current&&(cancelAnimationFrame(o.current),o.current=null)}},[p,x,V]);let W=(0,r.useCallback)(async()=>{if("undefined"==typeof navigator||!navigator.mediaDevices?.getUserMedia){_("ÐšÐ°Ð¼ÐµÑ€Ð° Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð² ÑÑ‚Ð¾Ð¼ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ"),c.current?.click();return}_(null),w(!0);try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}},audio:!1});s.current=e;let t=n.current;if(t){t.srcObject=e;try{await t.play()}catch{}}let[r]=e.getVideoTracks(),a=r?.getCapabilities?.()??void 0;E(!!a?.torch);let i=r?.getSettings?.()?.torch;I(!!i),v(!0),y(!1),C(!0),d.current=0}catch(e){U(),_(e?.message??"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÐºÐ°Ð¼ÐµÑ€Ðµ"),D&&c.current?.click()}finally{w(!1)}},[D,U]),L=(0,r.useCallback)(async(e,t="file")=>{if(!e)return;let r=i.current;if(!r)return;let a=r.getContext("2d",{willReadFrequently:!0});if(a){_(null);try{if("undefined"!=typeof createImageBitmap){let t=await createImageBitmap(e);r.width=t.width,r.height=t.height,a.drawImage(t,0,0),"function"==typeof t.close&&t.close()}else{let t=URL.createObjectURL(e);await new Promise((e,n)=>{let i=new Image;i.onload=()=>{r.width=i.naturalWidth,r.height=i.naturalHeight,a.drawImage(i,0,0),e()},i.onerror=()=>n(Error("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ")),i.src=t}).finally(()=>{URL.revokeObjectURL(t)})}let n=a.getImageData(0,0,r.width,r.height),i=await O(n,{enhance:!0});P(i.text,t)}catch(e){e?.notFound?_("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ð¹Ñ‚Ð¸ QR-ÐºÐ¾Ð´ Ð½Ð° Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¸"):_(e?.message??"Ð¤Ð°Ð¹Ð» Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ QR-ÐºÐ¾Ð´")}}},[P,O]),H=(0,r.useCallback)(async()=>{let e=s.current,t=e?.getVideoTracks()[0];if(!t?.getCapabilities)return;let r=t.getCapabilities();if(r?.torch)try{await t.applyConstraints({advanced:[{torch:!F}]}),I(e=>!e)}catch(e){_(e?.message??"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ„Ð¾Ð½Ð°Ñ€Ð¸Ðº")}},[F]);return(0,r.useEffect)(()=>{let e=!1;return async function(){if("undefined"==typeof navigator||!navigator.mediaDevices?.enumerateDevices)return C(!1);try{let t=await navigator.mediaDevices.enumerateDevices();e||C(t.some(e=>"videoinput"===e.kind))}catch{e||C(!1)}}(),()=>{e=!0}},[]),(0,r.useEffect)(()=>()=>{U(),f.current&&f.current.close?.()},[U]),(0,t.jsxs)("section",{className:"card",children:[(0,t.jsx)("header",{className:"card__header",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"ÐšÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¸Ð¹ ÑÐºÐ°Ð½ÐµÑ€"}),(0,t.jsx)("p",{children:"ÐšÐ°Ð¼ÐµÑ€Ð°, Ð²ÐµÐ±ÐºÐ° Ð¸Ð»Ð¸ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ â€” Ð²ÑÑ‘ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾."})]})}),(0,t.jsxs)("div",{className:"scanner",children:[(0,t.jsxs)("div",{className:"scanner__viewport",children:[(0,t.jsxs)("div",{className:`scanner__frame${N?" scanner__frame--flash":""}`,children:[(0,t.jsx)("video",{ref:n,playsInline:!0,muted:!0,autoPlay:!0,className:x?"paused":""}),(0,t.jsxs)("div",{className:"scanner__overlay","aria-hidden":!0,children:[(0,t.jsx)("div",{className:"scanner__mask"}),(0,t.jsxs)("div",{className:"scanner__target",children:[(0,t.jsx)("span",{}),(0,t.jsx)("span",{}),(0,t.jsx)("span",{}),(0,t.jsx)("span",{})]})]})]}),(0,t.jsx)("canvas",{ref:i,className:"scanner__canvas","aria-hidden":!0}),(0,t.jsxs)("div",{className:"scanner__controls",children:[(0,t.jsx)("button",{type:"button",onClick:p?U:W,className:p?"secondary":"primary",disabled:j,children:p?"ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ":j?"Ð—Ð°Ð¿ÑƒÑÐºâ€¦":"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÐºÐ°Ð¼ÐµÑ€Ñƒ"}),p&&S?(0,t.jsx)("button",{type:"button",onClick:H,className:F?"secondary active":"secondary","aria-pressed":F,children:F?"Ð¤Ð¾Ð½Ð°Ñ€Ð¸Ðº Ð²Ñ‹ÐºÐ».":"Ð¤Ð¾Ð½Ð°Ñ€Ð¸Ðº"}):null,(0,t.jsxs)("label",{className:"upload",children:[(0,t.jsx)("input",{ref:c,type:"file",accept:"image/png,image/jpeg,image/webp,image/svg+xml",onChange:e=>{let t=e.target.files?.[0];t&&L(t),e.target.value=""}}),(0,t.jsx)("span",{children:"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ"})]})]}),(0,t.jsx)("p",{className:"scanner__status",children:q}),T?(0,t.jsx)("p",{className:"error-text",children:T}):null]}),(0,t.jsxs)("div",{className:"scanner__results",children:[(0,t.jsx)("h3",{children:"ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹"}),0===b.length?(0,t.jsx)("p",{className:"hint",children:"ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…"}):(0,t.jsx)("ul",{children:b.map(e=>(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"pill pill__small",children:"camera"===e.source?"ðŸ“·":"ðŸ–¼ï¸"}),(0,t.jsx)("code",{children:e.text}),(0,t.jsx)("small",{children:new Date(e.timestamp).toLocaleTimeString()})]},`${e.timestamp}-${e.text}`))})]})]})]})}e.s(["Scanner",()=>a])},72692,e=>{e.n(e.i(99024))}]);